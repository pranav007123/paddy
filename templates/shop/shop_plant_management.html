{% extends 'base.html' %}
{% load static %}

{% block title %}Plant Management - Agricultural Intelligence{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row mb-5">
        <div class="col-12">
            <span class="section-tag">Inventory Control</span>
            <h2 class="section-title"><i class="fas fa-seedling me-2"></i>My Plant Collection</h2>
        </div>
    </div>

    <!-- Add Plant Form -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="feature-card p-4">
                <h4 class="font-weight-bold mb-4"><i class="fas fa-plus-circle text-primary me-2"></i>Register New Plant
                </h4>
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-4">
                                <label class="form-label small font-weight-bold text-muted text-uppercase">Plant
                                    Identification</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-white border-end-0"
                                        style="border-radius: 12px 0 0 12px;"><i
                                            class="fas fa-tag text-primary"></i></span>
                                    <input type="text" name="{{ form.name.name }}" id="{{ form.name.id_for_label }}"
                                        class="form-control border-start-0" placeholder="e.g. Organic Basmati Rice"
                                        style="border-radius: 0 12px 12px 0;" required
                                        value="{{ form.name.value|default:'' }}">
                                </div>
                                {% if form.name.errors %}<div class="text-danger small mt-1">{{ form.name.errors }}
                                </div>{% endif %}
                            </div>

                            <div class="mb-4">
                                <label class="form-label small font-weight-bold text-muted text-uppercase">Growth
                                    Category</label>
                                {{ form.category }}
                                <style>
                                    #id_category {
                                        border-radius: 12px;
                                        padding: 10px 15px;
                                        border: 1px solid #e2e8f0;
                                        width: 100%;
                                    }
                                </style>
                                {% if form.category.errors %}<div class="text-danger small mt-1">{{ form.category.errors
                                    }}</div>{% endif %}
                            </div>

                            <div class="row">
                                <div class="col-6 mb-4">
                                    <label class="form-label small font-weight-bold text-muted text-uppercase">Price
                                        (₹)</label>
                                    <input type="number" name="{{ form.price.name }}" id="{{ form.price.id_for_label }}"
                                        class="form-control" placeholder="0.00" step="0.01" style="border-radius: 12px;"
                                        required value="{{ form.price.value|default:'' }}">
                                    {% if form.price.errors %}<div class="text-danger small mt-1">{{ form.price.errors
                                        }}</div>{% endif %}
                                </div>
                                <div class="col-6 mb-4">
                                    <label class="form-label small font-weight-bold text-muted text-uppercase">Initial
                                        Stock</label>
                                    <input type="number" name="{{ form.stock.name }}" id="{{ form.stock.id_for_label }}"
                                        class="form-control" placeholder="Quantity" style="border-radius: 12px;"
                                        required value="{{ form.stock.value|default:'' }}">
                                    {% if form.stock.errors %}<div class="text-danger small mt-1">{{ form.stock.errors
                                        }}</div>{% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="mb-4">
                                <label class="form-label small font-weight-bold text-muted text-uppercase">Scientific &
                                    Commercial Description</label>
                                <textarea name="{{ form.description.name }}" id="{{ form.description.id_for_label }}"
                                    class="form-control" rows="4"
                                    placeholder="Describe the plant species, growth conditions, and benefits..."
                                    style="border-radius: 12px;">{{ form.description.value|default:'' }}</textarea>
                                {% if form.description.errors %}<div class="text-danger small mt-1">{{
                                    form.description.errors }}</div>{% endif %}
                            </div>

                            <div class="mb-4">
                                <label class="form-label small font-weight-bold text-muted text-uppercase">Display
                                    Photograph</label>
                                <div class="custom-file-upload p-4 border-dashed rounded-3 text-center bg-light">
                                    <i class="fas fa-cloud-upload-alt fa-2x text-primary mb-2"></i>
                                    <p class="small text-muted mb-2">Select a high-quality JPEG/PNG image</p>
                                    <input type="file" name="{{ form.image.name }}" id="{{ form.image.id_for_label }}"
                                        class="form-control-file">
                                </div>
                                {% if form.image.errors %}<div class="text-danger small mt-1">{{ form.image.errors }}
                                </div>{% endif %}
                            </div>
                        </div>
                    </div>

                    <div class="text-end mt-4">
                        <button type="submit" class="btn btn-premium btn-premium-primary px-5 py-3">
                            <i class="fas fa-save me-2"></i>Register Plant Record
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Existing Plants -->
    <div class="row">
        <div class="col-12">
            <div class="feature-card p-0 overflow-hidden">
                <div class="p-4 border-bottom bg-light">
                    <h5 class="font-weight-bold mb-0">Active Catalog ({{ plants|length }})</h5>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="bg-light small">
                            <tr>
                                <th class="ps-4">Preview</th>
                                <th>Plant Details</th>
                                <th>Status</th>
                                <th class="text-center">Stock</th>
                                <th class="text-end">Pricing</th>
                                <th class="pe-4 text-center">Operations</th>
                            </tr>
                        </thead>
                        <tbody class="small">
                            {% for plant in plants %}
                            <tr>
                                <td class="ps-4">
                                    {% if plant.image %}
                                    <img src="{{ plant.image.url }}" alt="{{ plant.name }}" width="60" height="60"
                                        class="rounded-3 shadow-sm" style="object-fit: cover;">
                                    {% else %}
                                    <div class="bg-light rounded-3 d-flex align-items-center justify-content-center"
                                        style="width: 60px; height: 60px;">
                                        <i class="fas fa-image text-muted"></i>
                                    </div>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="font-weight-bold h6 mb-0">{{ plant.name }}</div>
                                    <span class="text-muted small">{{ plant.category.name }}</span>
                                </td>
                                <td>
                                    <span
                                        class="badge rounded-pill {% if plant.stock > 10 %}bg-emerald text-white{% elif plant.stock > 0 %}bg-warning text-dark{% else %}bg-danger text-white{% endif %}">
                                        {% if plant.stock > 0 %}In Stock{% else %}Out of Stock{% endif %}
                                    </span>
                                </td>
                                <td class="text-center h6 mb-0 font-weight-bold">{{ plant.stock }}</td>
                                <td class="text-end h6 mb-0 font-weight-bold text-primary">₹{{ plant.price }}</td>
                                <td class="pe-4 text-center">
                                    <div class="d-flex justify-content-center gap-2">
                                        <a href="{% url 'edit_plant' plant.id %}" class="btn btn-sm btn-outline-primary"
                                            style="border-radius: 8px; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center;">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <a href="{% url 'delete_plant' plant.id %}"
                                            class="btn btn-sm btn-outline-danger"
                                            style="border-radius: 8px; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center;"
                                            onclick="return confirm('Secure Delete: Are you sure you want to remove {{ plant.name }} from catalog?');">
                                            <i class="fas fa-trash"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="p-5 text-center">
                                    <div class="py-4">
                                        <i class="fas fa-seedling fa-3x text-muted opacity-25 mb-4"></i>
                                        <h5 class="text-secondary">No plants registered yet</h5>
                                        <p class="text-muted small">Begin by adding your first botanical product using
                                            the form above.</p>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .border-dashed {
        border: 2px dashed #e2e8f0;
    }

    .bg-emerald {
        background-color: var(--primary) !important;
    }

    .gap-2 {
        gap: 0.5rem;
    }

    .input-group-text {
        border-color: #e2e8f0;
    }

    .form-control:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 0.25rem rgba(5, 150, 105, 0.1);
    }
</style>
{% endblock %}