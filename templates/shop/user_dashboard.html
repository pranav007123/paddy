{% extends 'shop/shop_base.html' %}

{% block title %}User Dashboard - Plant Health System{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-3 bg-light sidebar">
            <div class="p-3">
                <h4><i class="fas fa-user me-2"></i>{{ user.username }}</h4>
                <hr>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'user_dashboard' %}"><i class="fas fa-tachometer-alt me-2"></i>Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'user_profile' %}"><i class="fas fa-user-circle me-2"></i>Profile</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'view_shops_user' %}"><i class="fas fa-store me-2"></i>Shops</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'view_categories_plants' %}"><i class="fas fa-seedling me-2"></i>Plants</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'view_cart' %}"><i class="fas fa-shopping-cart me-2"></i>Cart</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'view_previous_orders' %}"><i class="fas fa-history me-2"></i>Orders</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'send_complaint' %}"><i class="fas fa-comment me-2"></i>Complaints</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'send_app_review' %}"><i class="fas fa-star me-2"></i>Reviews</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'change_password_user' %}"><i class="fas fa-key me-2"></i>Change Password</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'logout' %}"><i class="fas fa-sign-out-alt me-2"></i>Logout</a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-md-9">
            <h2><i class="fas fa-tachometer-alt me-2"></i>User Dashboard</h2>
            <hr>

            <!-- Stats Cards -->
            <div class="row mb-4">
                <div class="col-md-3 mb-3">
                    <div class="card user-card">
                        <div class="card-body text-center">
                            <i class="fas fa-store fa-2x text-success mb-2"></i>
                            <h5>{{ shops.count }}</h5>
                            <p class="text-muted">Available Shops</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card user-card">
                        <div class="card-body text-center">
                            <i class="fas fa-seedling fa-2x text-primary mb-2"></i>
                            <h5>{{ plants.count }}</h5>
                            <p class="text-muted">Available Plants</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card user-card">
                        <div class="card-body text-center">
                            <i class="fas fa-tags fa-2x text-warning mb-2"></i>
                            <h5>{{ categories.count }}</h5>
                            <p class="text-muted">Categories</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card user-card">
                        <div class="card-body text-center">
                            <i class="fas fa-shopping-cart fa-2x text-info mb-2"></i>
                            <h5>{{ cart_items_count }}</h5>
                            <p class="text-muted">Items in Cart</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Popular Plants -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5><i class="fas fa-seedling me-2"></i>Popular Plants</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% for plant in plants|slice:":4" %}
                        <div class="col-md-3 mb-3">
                            <div class="card plant-card h-100">
                                <img src="{{ plant.image.url|default:'https://via.placeholder.com/300x200' }}" class="card-img-top" alt="{{ plant.name }}">
                                <div class="card-body">
                                    <h6 class="card-title">{{ plant.name|truncatechars:20 }}</h6>
                                    <p class="card-text small">{{ plant.description|truncatewords:10 }}</p>
                                    <p class="card-text"><i class="fas fa-store text-success me-1"></i>{{ plant.shop.shop_name|truncatechars:15 }}</p>
                                    <p class="card-text"><strong>₹{{ plant.price }}</strong></p>
                                    <a href="{% url 'view_categories_plants' %}" class="btn btn-success btn-sm">View Details</a>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="col-12 text-center">
                            <p class="text-muted">No plants available yet.</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Popular Shops -->
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-store me-2"></i>Popular Shops</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% for shop in shops|slice:":4" %}
                        <div class="col-md-3 mb-3">
                            <div class="card h-100">
                                <div class="card-img-top text-center p-3 bg-light">
                                    <i class="fas fa-store fa-3x text-success"></i>
                                </div>
                                <div class="card-body">
                                    <h6 class="card-title">{{ shop.shop_name|truncatechars:20 }}</h6>
                                    <p class="card-text small">{{ shop.description|truncatewords:8 }}</p>
                                    <p class="card-text"><i class="fas fa-map-marker-alt text-success me-1"></i>{{ shop.address|truncatewords:3 }}</p>
                                    <p class="card-text"><i class="fas fa-phone text-primary me-1"></i>{{ shop.contact_number|default:"N/A" }}</p>
                                    
                                    <!-- Show a preview of plants from this shop -->
                                    {% with shop.plants.all|slice:":2" as shop_plants %}
                                    {% if shop_plants %}
                                    <div class="mt-2">
                                        <small class="text-muted">Featured Plants:</small>
                                        {% for plant in shop_plants %}
                                        <div class="d-flex justify-content-between align-items-center mt-1">
                                            <span class="small">{{ plant.name|truncatechars:12 }}</span>
                                            <span class="small text-success">₹{{ plant.price }}</span>
                                        </div>
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                    {% endwith %}
                                    
                                    <a href="{% url 'view_shops_user' %}" class="btn btn-outline-success btn-sm mt-2">Visit Shop</a>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="col-12 text-center">
                            <p class="text-muted">No shops available yet.</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}