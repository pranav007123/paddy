{% extends 'base.html' %}
{% load static %}

{% block title %}Consumer Intelligence Center - Agricultural Intelligence{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- Welcome Header -->
    <div class="row mb-5">
        <div class="col-12">
            <span class="section-tag">User Ecosystem</span>
            <h2 class="section-title mb-0"><i class="fas fa-tachometer-alt me-2 text-primary"></i>Operational Dashboard
            </h2>
            <p class="text-muted mt-2">Welcome back, {{ user.username }}. Here is your agricultural oversight.</p>
        </div>
    </div>

    <!-- Analytics Tokens -->
    <div class="row mb-5">
        <div class="col-md-3 mb-4 mb-md-0">
            <div class="feature-card p-4 text-center h-100 shadow-sm border-bottom border-primary border-4">
                <div class="stat-icon mb-3 mx-auto shadow-sm"
                    style="background: rgba(5, 150, 105, 0.1); width: 60px; height: 60px; border-radius: 15px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-store text-primary fa-xl"></i>
                </div>
                <h3 class="font-weight-bold mb-1">{{ shops.count }}</h3>
                <p class="text-muted small text-uppercase font-weight-bold mb-0">Active Merchants</p>
            </div>
        </div>
        <div class="col-md-3 mb-4 mb-md-0">
            <div class="feature-card p-4 text-center h-100 shadow-sm border-bottom border-indigo border-4">
                <div class="stat-icon mb-3 mx-auto shadow-sm"
                    style="background: rgba(79, 70, 229, 0.1); width: 60px; height: 60px; border-radius: 15px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-seedling text-indigo fa-xl"></i>
                </div>
                <h3 class="font-weight-bold mb-1">{{ plants.count }}</h3>
                <p class="text-muted small text-uppercase font-weight-bold mb-0">Catalog Assets</p>
            </div>
        </div>
        <div class="col-md-3 mb-4 mb-md-0">
            <div class="feature-card p-4 text-center h-100 shadow-sm border-bottom border-warning border-4">
                <div class="stat-icon mb-3 mx-auto shadow-sm"
                    style="background: rgba(245, 158, 11, 0.1); width: 60px; height: 60px; border-radius: 15px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-tags text-warning fa-xl"></i>
                </div>
                <h3 class="font-weight-bold mb-1">{{ categories.count }}</h3>
                <p class="text-muted small text-uppercase font-weight-bold mb-0">Taxonomy Groups</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="feature-card p-4 text-center h-100 shadow-sm border-bottom border-emerald border-4">
                <div class="stat-icon mb-3 mx-auto shadow-sm"
                    style="background: rgba(16, 185, 129, 0.1); width: 60px; height: 60px; border-radius: 15px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-shopping-cart text-emerald fa-xl"></i>
                </div>
                <h3 class="font-weight-bold mb-1 text-emerald">{{ cart_items_count }}</h3>
                <p class="text-muted small text-uppercase font-weight-bold mb-0">Procurement Items</p>
            </div>
        </div>
    </div>

    <!-- Discovery Sections -->
    <div class="row">
        <!-- Popular Plants -->
        <div class="col-lg-12 mb-5">
            <div class="d-flex justify-content-between align-items-end mb-4">
                <div>
                    <span class="section-tag">Featured Catalog</span>
                    <h4 class="font-weight-bold mb-0">Trending Botanical Assets</h4>
                </div>
                <a href="{% url 'view_categories_plants' %}" class="btn btn-premium btn-premium-outline btn-sm">Explorer
                    Registry</a>
            </div>
            <div class="row">
                {% for plant in plants|slice:":4" %}
                <div class="col-md-3 mb-4">
                    <div class="feature-card p-0 overflow-hidden h-100 transition-up">
                        <img src="{{ plant.image.url|default:'https://via.placeholder.com/300x200' }}" class="w-100"
                            alt="{{ plant.name }}" style="height: 180px; object-fit: cover;">
                        <div class="p-3">
                            <span class="badge bg-light text-primary mb-2" style="font-size: 0.65rem;">{{
                                plant.category.name|upper }}</span>
                            <h6 class="font-weight-bold mb-1">{{ plant.name|truncatechars:20 }}</h6>
                            <p class="text-muted small mb-3">{{ plant.description|truncatewords:8 }}</p>
                            <div class="d-flex justify-content-between align-items-center pt-2 border-top">
                                <span class="font-weight-bold text-dark">₹{{ plant.price }}</span>
                                <a href="{% url 'view_categories_plants' %}"
                                    class="btn btn-premium btn-premium-primary btn-sm px-3">View</a>
                            </div>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="col-12 text-center py-5">
                    <p class="text-muted">No catalog assets currently indexed.</p>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Popular Shops -->
        <div class="col-lg-12">
            <div class="d-flex justify-content-between align-items-end mb-4">
                <div>
                    <span class="section-tag">Partner Network</span>
                    <h4 class="font-weight-bold mb-0">Top-Tier Merchants</h4>
                </div>
                <a href="{% url 'view_shops_user' %}" class="btn btn-premium btn-premium-outline btn-sm">Global
                    Directory</a>
            </div>
            <div class="row">
                {% for shop in shops|slice:":4" %}
                <div class="col-md-3 mb-4">
                    <div class="feature-card p-4 h-100 transition-up">
                        <div class="d-flex align-items-center mb-3">
                            <div class="p-3 rounded-circle bg-light me-3">
                                <i class="fas fa-store text-primary"></i>
                            </div>
                            <div>
                                <h6 class="font-weight-bold mb-0">{{ shop.shop_name|truncatechars:15 }}</h6>
                                <small class="text-muted">{{ shop.address|truncatewords:2 }}</small>
                            </div>
                        </div>
                        <p class="text-muted small mb-3">{{ shop.description|truncatewords:10 }}</p>

                        {% with shop.plants.all|slice:":2" as shop_plants %}
                        {% if shop_plants %}
                        <div class="bg-light p-2 rounded-3 mb-3">
                            {% for plant in shop_plants %}
                            <div class="d-flex justify-content-between align-items-center mb-1">
                                <span class="small text-dark">{{ plant.name|truncatechars:12 }}</span>
                                <span class="small font-weight-bold text-primary">₹{{ plant.price }}</span>
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                        {% endwith %}

                        <a href="{% url 'view_shops_user' %}"
                            class="btn btn-premium btn-premium-primary w-100 btn-sm">Access Storefront</a>
                    </div>
                </div>
                {% empty %}
                <div class="col-12 text-center py-5">
                    <p class="text-muted">No merchant nodes active in the network.</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<style>
    .transition-up:hover {
        transform: translateY(-5px);
        transition: transform 0.2s ease-in-out;
    }

    .text-emerald {
        color: #10b981 !important;
    }

    .border-emerald {
        border-color: #10b981 !important;
    }

    .text-indigo {
        color: #4f46e5 !important;
    }

    .border-indigo {
        border-color: #4f46e5 !important;
    }
</style>
{% endblock %}